module.exports=function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=27)}([function(t,e){t.exports=require("bluebird")},function(t,e,n){"use strict";(function(){var e=n(12),r={init:function(t){return t._jsonit={_meta:{id:e(),commits:[],pulls:{}},users:{},groups:{}},t},isInitialized:function(t){return void 0!==t._jsonit},getId:function(t){return t._jsonit._meta.id},setId:function(t,e){t._jsonit._meta.id=e},getCommits:function(t){return t._jsonit._meta.commits},getPulls:function(t){return t._jsonit._meta.pulls},setPulls:function(t,e){t._jsonit._meta.pulls=e},getUsers:function(t){return t._jsonit.users},getGroups:function(t){return t._jsonit.groups},getListeners:function(t){return t._jsonit.listeners},setListeners:function(t,e){t._jsonit.listeners=e},setMeta:function(t,e){return t._jsonit._meta=e,t},removeMeta:function(t){var e=t._jsonit._meta;return delete t._jsonit._meta,e},resetMeta:function(t){delete t._jsonit._meta.commits,delete t._jsonit._meta.pulls}};r.ID_PATH="_jsonit._meta.id",r.META_PATH="_jsonit",r.JSONIT_USERS="_jsonit.users.",r.JSONIT_GROUPS="_jsonit.groups.",r.JSONIT_USER="_jsonit.users",r.JSONIT_GROUP="_jsonit.groups",r.JSONIT_COMMITS="_jsonit._meta.commits",r.JSONIT_PULLS="_jsonit._meta.pulls",r.READ="read",r.WRTIE="write",t.exports=r}).call(void 0)},function(t,e){t.exports=require("lodash")},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};(function(){var e=n(2),i=function(t,e){this.root=this.compare(t,e),null===this.root&&(this.root={})};i.prototype.didChange=function(){return 0!==Object.keys(this.root).length},i.prototype.compare=function(t,e){return Array.isArray(t)&&Array.isArray(e)?this.compareArrays(t,e):this.compareObjects(t,e)},i.prototype.compareArrays=function(t,e,n){for(var o=0,s=0,u=[];o<t.length||s<e.length;){var c=null,a=null,l=null,h=null,f=null;if(o<t.length&&(c=r(t[o]),a=t[o]),s<e.length&&(l=r(e[s]),h=e[s]),null===(f=null===a||null===h||this.compareFields(c,a,l,h,o)))o++,s++;else{for(var p=0;p+s<e.length;){p++;var d=r(e[s+p]),m=e[s+p];if(null===this.compareFields(c,a,d,m,o+p))break}p=0===p?t.length+e.length+1:p;for(var y=0;y+o<t.length;){y++;var g=r(t[o+y]),v=t[o+y];if(null===this.compareFields(g,v,l,h,o+y))break}y=0===y?t.length+e.length+1:y;for(var S=0,T=[];S+o<t.length&&S+s<e.length;){S++,T.push(f);var v=t[o+S],m=e[s+S];if(null===(f=this.compare(v,m)))break}if(S=0===S?t.length+e.length+1:S,p<=y&&p<=S){for(var _=0;_<p;_++)u.push(new i.Change(s+_,e[s+_],i.Change.Add));s+=p}else if(y<=p&&y<=S){for(var _=0;_<y;_++)u.push(new i.Change(s,null,i.Change.Delete));o+=y}else{for(var _=0;_<S;_++)u.push(new i.Change(s+_,T[_],i.Change.Modify));o+=S,s+=S}}}return 0===u.length&&(u=null),u},i.prototype.compareObjects=function(t,n){var o=this,s={},u=e.keys(t),c=e.keys(n);if(0===u.length&&0===c.length){var a=void 0===t?"undefined":r(t),l=void 0===n?"undefined":r(n),h=t,f=n;s=o.compareFields(a,h,l,f,null)}else{var p=e.difference(c,u);e.forEach(p,function(t){s[t]=new i.Change(t,n[t],i.Change.Add)});var d=e.difference(u,c);e.forEach(d,function(t){s[t]=new i.Change(t,null,i.Change.Delete)});var m=e.intersection(u,c);e.forEach(m,function(e){var i=r(t[e]),u=r(n[e]),c=t[e],a=n[e],l=o.compareFields(i,c,u,a,e);null!==l&&(s[e]=l)}),0===e.keys(s).length&&(s=null)}return s},i.prototype.compareFields=function(t,n,o,s,u){var c=null;return s instanceof Date&&(s=s.toJSON(),o=void 0===s?"undefined":r(s)),n instanceof Date&&(n=n.toJSON(),t=void 0===n?"undefined":r(n)),t!==o?c=new i.Change(u,s,i.Change.Modify):"object"!==t?n!==s&&(c=new i.Change(u,s,i.Change.Modify)):0===e.keys(n).length||0===e.keys(s).length?n===s||"object"===t&&"object"===o&&null!==n&&null!==s&&e.keys(n).length===e.keys(s).length||(c=new i.Change(u,s,i.Change.Modify)):c=this.compare(n,s),c},i.Change=function(t,e,n){this.field=t,this.value=e,this.type=n,this.__Diff=!0},i.Change.Add=0,i.Change.Modify=1,i.Change.Delete=2,t.exports=i}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(2),r=function(){};r.prototype.checkAccess=function(t,e,n,i,o,s){var u=!!e[r.DEFAULT]&&e[r.DEFAULT][s],c=i.replace(/\./g,"-");if(t===i)u=!0;else if(void 0!==e[c]&&e[c][s])u=!0;else for(var a=0;a<o.length;a++){var l=o[a].replace(/\./g,"-");if(void 0!==n[l]&&n[l][s]){u=!0;break}}return u},r.prototype.assignUserToObject=function(t,e,n,i){var o=e.replace(/\./g,"-"),s=new r.Entry(n,i);return t[o]=s,t},r.prototype.assignGroupToObject=function(t,e,n,i){var o=e.replace(/\./g,"-"),s=new r.Entry(n,i);return t[o]=s,t},r.prototype.addUserToGroup=function(t,n,r){return e.indexOf(n,r)<0&&n.push(r),n},r.Entry=function(t,e){this.read=t,this.write=e},r.READ_ACCESS="read",r.WRITE_ACCESS="write",r.DEFAULT="default",t.exports=r}).call(void 0)},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};(function(){var e=n(2),i=n(10),o=n(3),s={merge:function(t,n){return n=JSON.parse(JSON.stringify(n)),e.forEach(n,function(e){t=s._mergeSingle(t,e.root)}),t},_mergeSingle:function(t,e){return t=Array.isArray(t)?s._mergeSingleArray(t,e):"object"===(void 0===t?"undefined":r(t))?s._mergeSingleObject(t,e):s._mergeSingleItem(t,e,null)},_mergeSingleObject:function(t,n){var r=e.keys(n);return e.forEach(r,function(e){var r=s._mergeSingleItem(t,n[e],e);n[e].type!==o.Change.Delete&&(t[e]=r)}),t},_mergeSingleArray:function(t,e){for(var n=0;n<e.length;n++){var u=e[n];o.Change.Add===u.type?t.splice(u.field,0,i.convert(u.value)):o.Change.Delete===u.type?t.splice(u.field,1):"object"===r(u.value)?t[u.field]=s._mergeSingle(t[u.field],u.value):t[u.field]=i.convert(u.value)}return t},_mergeSingleItem:function(t,e,n){var r=null;return o.Change.Add===e.type||o.Change.Modify===e.type?r=i.convert(e.value):o.Change.Delete===e.type?delete t[n]:r=null!==n?s._mergeSingle(t[n],e):i.convert(e.value),r}};t.exports=s}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(2),r=n(49),i={extend:function(t){var n={merge:function(){for(var t=arguments,e="",n=0;n<t.length;n++)null!=t[n]&&(e+=t[n]);return e},iftrue:function(t,e,n){return t?e:n},ifeq:function(t,e,n,r){return t==e?n:r},ifneq:function(t,e,n,r){return t!=e?n:r},ifgt:function(t,e,n,r){return t>e?n:r},iflt:function(t,e,n,r){return t<e?n:r},sane:function(t){return null==t&&(t=""),t},minDate:function(t,e){var n=r(t),i=r(e);return""!==t&&n.isValid()?""!==e&&i.isValid()?r.min(n,i):n:i},maxDate:function(t,e){var n=r(t),i=r(e);return""!==t&&n.isValid()?""!==e&&i.isValid()?r.max(n,i):n:i},dt:function(t,e){var n;if(null!=e)n=r(t,e).toDate();else try{n=new Date(t)}catch(t){}return n},dtstr:function(t,e){return r(t).format(e)},today:function(){return new Date},arrstr:function(t,e,n){var r=e||"",i=n||"";return t.map(function(t){return r+t+i}).join("")},dtadd:function(t,e,n){var i=r({year:t.year,month:t.month-1,date:t.day,hour:t.hour,minute:t.minute,seconds:t.second});return i.add(e,n),i},sortedIns:function(t,n,r){Array.isArray(t)||(t=[]),null==r&&(r=!1),Array.isArray(n)||(n=[n]);for(var i=0;i<n.length;i++){var o=n[i],s=e.sortedIndex(t,o);(r||t[s]!==o)&&t.splice(s,0,o)}return t},debug:function(){null!=console.groupCollapsed?console.group("MathLib Debug: "+arguments[0]):console.log("MathLib Debug: "+arguments[0]);for(var t=1;t<arguments.length;t++)console.log(arguments[t]);return null!=console.groupEnd&&console.groupEnd(),arguments[1]}},i={override:!1,silent:!0,wrap:!0};t.import(n,i)}};t.exports=i}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(0),r=function(t,e){this.user=t,this.db=e};r.prototype.setup=function(){var t=this,n=this.db.getCollection(this.user+"_Branches",this.user+"_Branches");return this.db.promisified||(n=e.resolve(n)),n.then(function(e){return null===e?t.db.addCollection(t.user+"_Branches",t.user+"_Branches"):e})},r.prototype.checkout=function(t){var n=this.db.getCollection(t,this.user+"_Branch_"+t);return this.db.promisified||(n=e.resolve(n)),n},r.prototype.getMetaInfo=function(t,n){var r=this.db.getCollection(this.user+"_Branches",this.user+"_Branches");return this.db.promisified||(r=e.resolve(r)),r.then(function(e){return e.findOne({name:t},n)})},r.prototype.updateMetaInfo=function(t,n){var r=null,i=this.db.getCollection(this.user+"_Branches",this.user+"_Branches");return this.db.promisified||(i=e.resolve(i)),i.then(function(e){return r=e,r.findOne({name:t})}).then(function(e){return e.users=n.users,e.groups=n.groups,r.update({name:t},e)})},r.prototype.searchBranch=function(t){var n=this.db.getCollection(t,this.user+"_BranchSearch_"+t,!0);return this.db.promisified||(n=e.resolve(n)),n},r.prototype.add=function(t,e,n,i){var o=this,s=null;return this.checkout(t).then(function(e){return s=e,null===s?(o.db.addCollection(t,o.user+"_BranchSearch_"+t,!0),o.db.addCollection(t,o.user+"_Branch_"+t)):null}).then(function(t){return null!=t?(s=t,o.db.getCollection(o.user+"_Branches",o.user+"_Branches")):t}).then(function(o){if(null!=o){var u=new r.Branch(t,e,n,i);o.insert(u)}return s})},r.prototype.delete=function(t){var e=null,n=null;return this.checkout(t).bind(this).then(function(t){return e=t,this.db.getCollection(this.user+"_Branches",this.user+"_Branches")}).then(function(e){return n=e,n.findOne({name:t})}).then(function(r){var i=!1;return null!==e&&null!==r&&(this.db.removeCollection(this.user+"_Branch_"+t),this.db.removeCollection(this.user+"_BranchSearch_"+t),n.remove({name:t}),i=!0),i})},r.prototype.list=function(){var t=this.db.getCollection(this.user+"_Branches",this.user+"_Branches");return this.db.promisified||(t=e.resolve(t)),t.then(function(t){var e={map:function(t,e,n){return{key:t.name,params:{},value:t.name}},reduce:function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].value);return e}};return t.search({},null,e,["name"])})},r.Branch=function(t,e,n,r){this.name=t,this.users=null==e?{}:e,this.groups=null==n?{}:n,this.listeners=null==r?[]:r},t.exports=r}).call(void 0)},function(t,e,n){"use strict";(function(){var e=(n(2),n(12)),r=function(t){this.commits=void 0===t?[]:t};r.prototype.addCommit=function(t,e,n,i,o){this.commits.push(new r.Commit(t,e,n,i,o)),this.commits[0].isFirst=!0},r.prototype.prefixCommit=function(t,e,n,i,o){this.commits.unshift(new r.Commit(t,e,n,i,o)),this.commits[0].isFirst=!0,null!=this.commits[1]&&delete this.commits[1].isFirst},r.prototype.remove=function(t){return this.commits.splice(0,t)},r.prototype.getAllCommits=function(){return this.commits},r.prototype.getNoOfCommits=function(){return this.commits.length},r.prototype.getFilteredCommits=function(t,e){var n=[];for(var r=0;r<this.commits.length;r++){var i=this.commits[r];if(t!==i.commitId){if(n.push(i),e===i.commitId)break}else!0,n=[]}return n},r.Commit=function(t,n,r,i,o){this.diff=t,this.logMessage=n,this.dateAndTime=r,this.userId=i,this.commitId=void 0===o?e():o},t.exports=r}).call(void 0)},function(t,e,n){"use strict";(function(){var e=function(t){this.pulls=void 0===t?{}:t};e.prototype.updatePull=function(t,e,n){void 0===this.pulls[t]&&(this.pulls[t]={}),this.pulls[t].head=e,this.pulls[t].doc=n},e.prototype.getPullInformation=function(t){return void 0===this.pulls[t]&&(this.pulls[t]={}),this.pulls[t]},t.exports=e}).call(void 0)},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};(function(){var e=n(2),i={dateRegex:/^(19|20)[0-9]{2}-[0-1]{1}[0-9]{1}-[0-3]{1}[0-9]{1}T[0-2]{1}[0-9]{1}:[0-5]{1}[0-9]{1}:[0-5]{1}[0-9]{1}\.[0-9]{3}Z$/,convert:function(t){if(Array.isArray(t))t=i._convertArray(t);else if("object"===(void 0===t?"undefined":r(t)))t=i._convertObject(t);else if("string"==typeof t&&t.match(i.dateRegex))try{t=new Date(t)}catch(t){}return t},_convertObject:function(t){if(t instanceof Date)return t;for(var n=e.keys(t),r=0;r<n.length;r++){var o=n[r];t[o]=i.convert(t[o])}return t},_convertArray:function(t){for(var e=0;e<t.length;e++)t[e]=i.convert(t[e]);return t}};t.exports=i}).call(void 0)},function(t,e){t.exports=require("socket.io-client")},function(t,e){t.exports=require("uuid/v4")},function(t,e,n){"use strict";(function(){var e=n(0),r=n(33),i=n(28),o=function(t,n){if(this.dbname=t,this.options=n,this.database=null,this.promisified=!1,!0===this.options.autoload){var r=null;this.connectionPromise=new e(function(t){r=t}),this.connectionPromiseResolve=r}else this.connectionPromise=e.resolve(!0)};o.prototype.connect=function(){var t=this,e=this.options.autoload;return this.options.autoload=!1,this.database=new r(this.dbname,this.options),!0===e&&this.database.loadDatabase(this.options.inflateLocalDb||{},function(){t.connectionPromiseResolve(!0)}),this.connectionPromise},o.prototype.getCollection=function(t,e,n){var r=this.database.getCollection(e);return null!==r&&(r=new i(t,r,n)),r},o.prototype.addCollection=function(t,e,n){var r=this.database.addCollection(e);return r=new i(t,r,n)},o.prototype.removeCollection=function(t){return this.database.removeCollection(t)},t.exports=o}).call(void 0)},function(t,e,n){"use strict";var r=n(0),i=n(29),o=function(t){this.sqs=new r.promisifyAll(new i.SQS({accessKeyId:t.accessKeyId,secretAccessKey:t.secretAccessKey,endpoint:o.SQS_ENDPOINT,region:t.region}))};o.prototype.listQueues=function(){return this.sqs.listQueuesAsync()},o.prototype.createQueue=function(t,e,n,r,i,s,u){null!=r&&"number"==typeof r&&(r=r.toString()),null!=s&&"number"==typeof s&&(s=s.toString()),null!=n&&"number"==typeof n&&(n=n.toString()),null!=i&&"number"==typeof i&&(i=i.toString());var c={QueueName:t,Attributes:{}};return null!=r&&(c.Attributes.DelaySeconds=r),null!=n&&(c.Attributes.ReceiveMessageWaitTimeSeconds=n),null!=s&&(c.Attributes.MessageRetentionPeriod=s),null!=i&&(c.Attributes.VisibilityTimeout=i),e&&(c.Attributes.Policy=JSON.stringify(this.queuePolicyForTopic(e,null,t))),!0===u&&(c.QueueName=t+o.FIFO_SUFFIX,c.Attributes.FifoQueue=u.toString()),this.sqs.createQueueAsync(c)},o.prototype.deleteQueue=function(t){return this.sqs.deleteQueueAsync({QueueUrl:t})},o.prototype.sendMessage=function(t,e,n,r){var i={QueueUrl:t};if(!(e instanceof Array))return i.MessageBody=JSON.stringify(e),n&&(i.DelaySeconds=n),r&&(i.MessageGroupId=r),this.sqs.sendMessageAsync(i);i.Entries=[];for(var o=0;o<e.length;o++)i.Entries[o]={Id:o.toString(),MessageBody:JSON.stringify(e[o])},n&&(i.Entries[o].DelaySeconds=n),r&&(i.Entries[o].MessageGroupId=r);return e.length>0?this.sqs.sendMessageBatchAsync(i):void 0},o.prototype.receiveMessage=function(t,e,n,r){r=null!=r?r:"All";var i={QueueUrl:t,AttributeNames:[r]};null!=e&&(i.WaitTimeSeconds=e),null!=n&&(i.MaxNumberOfMessages=3);var o=[];return this.sqs.receiveMessageAsync(i).then(function(t){if(null==t.Messages)return o;for(var e=0;e<t.Messages.length;e++)o[e]=JSON.parse(t.Messages[e].Body);return o}).catch(function(t){return o})},o.prototype.deleteMessage=function(t,e){if(!(e instanceof Array))return this.sqs.deleteMessageAsync({QueueUrl:t,ReceiptHandle:e});for(var n={QueueUrl:t,Entries:[]},r=0;r<e.length;r++)n.Entries[r]={Id:r.toString(),ReceiptHandle:e[r]};return e.length>0?this.sqs.deleteMessageBatchAsync(n):void 0},o.prototype.purgeQueue=function(t){return this.sqs.purgeQueue({QueueUrl:t}).promise()},o.prototype.setTopic=function(t,e){var n=this;return this.getQueueAttributes(t).then(function(r){return n.sqs.setQueueAttributesAsync({QueueUrl:t,Attributes:{Policy:JSON.stringify(n.queuePolicyForTopic(e,r.Attributes.QueueArn))}})})},o.prototype.setDelay=function(t,e){return null!=e&&"number"==typeof e&&(e=e.toString()),this.sqs.setQueueAttributesAsync({QueueUrl:t,Attributes:{DelaySeconds:e}})},o.prototype.setMessageRetentionPeriod=function(t,e){return null!=e&&"number"==typeof e&&(e=e.toString()),this.sqs.setQueueAttributesAsync({QueueUrl:t,Attributes:{MessageRetentionPeriod:e}})},o.prototype.getQueueAttributes=function(t,e){return e=null!=e?e:"All",this.sqs.getQueueAttributesAsync({QueueUrl:t,AttributeNames:[e]})},o.prototype.queuePolicyForTopic=function(t,e,n){return{Version:"2012-10-17",Id:"S2A_RIKSOF/SQSDefaultPolicy",Statement:[{Sid:"SQSDefaultPolicy001",Effect:"Allow",Principal:"*",Action:"SQS:*",Resource:null!=e?e:"arn:aws:sqs:us-east-1:421969266154:"+n,Condition:{ArnEquals:{"aws:SourceArn":t}}}]}},o.SQS_ENDPOINT="https://sqs.us-east-1.amazonaws.com",o.FIFO_SUFFIX=".fifo",t.exports=o},function(t,e,n){"use strict";var r=n(11),i=n(0),o=function(t){var e=this;this.url=t,this.pendingRecv=null,this.socket=r(this.url),this.socket.on("connect",function(){null!=e.pendingRecv&&(e.pendingRecv([]),e.pendingRecv=null)})};o.prototype.sendMessage=function(t,e,n,r){var s=this;return new i(function(n){s.socket.emit(o.SEND_MESSAGE,{queue:t,messages:e},function(t){n(t)})})},o.prototype.receiveMessage=function(t,e,n,r){var s=this;return new i(function(e){s.pendingRecv=e,s.socket.emit(o.RECEIVE_MESSAGE,{queue:t,max:n},function(t){s.pendingRecv=null,e(t)})})},o.SEND_MESSAGE="send",o.RECEIVE_MESSAGE="receive",o.STATUS_DONE=200,t.exports=o},function(t,e,n){"use strict";(function(){var e=n(34),r=e.create();r.import(n(45)),r.import(n(46)),r.import(n(47)),r.import(n(48)),r.import(n(36)),r.import(n(37)),r.import(n(38)),r.import(n(39)),r.import(n(40)),r.import(n(41)),r.import(n(42)),r.import(n(43)),r.import(n(44)),r.import(n(35)),n(6).extend(r);var i=n(1),o=function(t,e){this.debug=null!=e&&e,this.projections=t,this.resultLength=0,this.keysToIndexMapping={}};o.prototype.map=function(t,e,n){for(var r={index:this.resultLength,key:"",params:{},value:{}},o=this.projections.map.keys,e=0;e<o.length;e++){var s=o[e];r.key+=t[s],r.params[s]=t[s]}var u="";i.isInitialized(t)&&(u=i.getId(t)),0===o.length&&(r.key=u,r.params.id=u);var c=this.keysToIndexMapping[r.key];return null==c?(this.keysToIndexMapping[r.key]=this.resultLength,this.resultLength++):r.index=c,r.value=t,r.value._id=u,r},o.prototype.reduce=function(t){for(var e=new Array(this.resultLength),n={},i={},o=Object.keys(this.projections.reduce),s=0;s<o.length;s++){var u=o[s];i[u]=r.compile(this.projections.reduce[u]),n[u]=""}for(var c={index:0,current:null,result:null,data:t,length:t.length},s=0;s<t.length;s++){var a=t[s],l=e[a.index];void 0===l&&(l={_params:a.params},e[a.index]=Object.assign(l,n),l=e[a.index]),c.index=s,c.current=a.value,c.result=l;for(var h=0;h<o.length;h++){var u=o[h];try{l[u]=i[u].eval(c)}catch(t){this.debug&&console.log(t)}}}return e},t.exports=o}).call(void 0)},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};(function(){var e=n(0),i=n(31),o=function(t,e,n){this.url=t,this.clientId=e,this.clientSecret=n,this.owner=null,this.auth=null,this.connection=null};o.prototype.connect=function(t,e){this.auth=new i({clientId:this.clientId,clientSecret:this.clientSecret,accessTokenUri:this.url+o.OAUTH_ENDPOINT,scopes:[]});var n=null,r=this;return void 0!==t?(n=this.auth.owner.getToken(t,e),this.owner=t):(n=this.auth.credentials.getToken(),this.owner=this.clientId),n=n.then(function(t){return r.connection=t,r})},o.prototype.reconnect=function(t,n,r,s){if(null==s&&(s=!0),this.auth=new i({clientId:this.clientId,clientSecret:this.clientSecret,accessTokenUri:this.url+o.OAUTH_ENDPOINT,scopes:[]}),this.owner=t,this.connection=this.auth.createToken(n,r,o.TOKEN_TYPE,{}),0==s)return e.resolve(this);var u=this;return this.connection.refresh().then(function(){return u})},o.prototype.pull=function(t,e,n,r,i,s){var u=this.connection.request({method:"GET",url:this.url+o.API_ENDPOINT+t+"/"+e+"/"+n,query:{start:i,end:s}}),c=this;return u=u.then(function(t){return t.status<200||t.status>=399?c.handleError(t):t.body})},o.prototype.push=function(t,e,n,r,i,s){var u=this.connection.request({method:"POST",url:this.url+o.API_ENDPOINT+e+"/"+n+"/"+r,headers:{"Content-Type":"application/json"},body:{branchFrom:t,commits:i,head:s}}),c=this;return u=u.then(function(t){return t.status<200||t.status>=399?c.handleError(t):i})},o.prototype.search=function(t,e,n,r,i,s,u,c,a,l,h,f){var p=this.connection.request({method:"POST",url:this.url+o.API_ENDPOINT+t+"/"+e+"/find/"+n,query:{start:l,end:h,refreshTime:i},body:{query:r,projections:s,sort:u,start:c,limit:a,listeners:f}}),d=this;return p=p.then(function(t){return t.status<200||t.status>=399?d.handleError(t):t.body})},o.prototype.createBranch=function(t,e,n,r){var i=this.connection.request({method:"POST",url:this.url+o.API_ENDPOINT+this.owner+"/"+t+"/",body:{users:e,groups:n,listeners:r}}),s=this;return i=i.then(function(t){return!(t.status<200||t.status>=399)||s.handleError(t)})},o.prototype.chunkForFile=function(t){var e=this.connection.request({method:"POST",url:this.url+o.API_ENDPOINT+this.owner+"/"+t+"/"}),n=this;return e=e.then(function(t){return!(t.status<200||t.status>=399)||n.handleError(t)})},o.prototype.handleError=function(t){var e=null;throw e="object"===r(t.body)?new Error(t.body.error_message):new Error(t.body+"("+t.status+")"),e.status=t.status,e.body=t.body,e},o.OAUTH_ENDPOINT="/oauth/token",o.API_ENDPOINT="/api/",o.TOKEN_TYPE="bearer",t.exports=o}).call(void 0)},function(t,e,n){"use strict";(function(){var e=(n(0),n(4)),r=n(1),i=function(t,e){this.repo=t,this.fsBranch=e};i.prototype.newFolder=function(t,e){var n=new i.Entry(t,i.TYPE_DIRECTORY,e);return this.repo.commit(this.fsBranch,n,"Folder: "+t)},i.prototype.newFile=function(t,n,o,s,u,c,a,l,h,f,p){var d=null!=f?f:n;return this.repo.get(this.fsBranch,d).bind(this).then(function(f){if(r.getCommits(f).length>0)return f;var m=new i.Entry(t,i.TYPE_FILE,a,n,o,s,u,c,l,h);if(r.init(m),r.setId(m,d),p){var y=r.getUsers(m);(new e).assignUserToObject(y,e.DEFAULT,!0,!1)}return this.repo.commit(this.fsBranch,m,"File: "+t)})},i.Entry=function(t,e,n,r,o,s,u,c,a,l){if(this.name=t,this.type=e,this.parentId=n,this.lastModifiedTime=s,this.type===i.TYPE_FILE){this.fId=r,this.hash=o,this.size=u,this.ext=c,this.uploadTime=a,this.status=null!=l?l:i.UPLOAD_NOT_STARTED,this.totalChunks=Math.ceil(this.size/i.CHUNK_SIZE),this.chunkStatus=new Array(this.totalChunks);for(var h=0;h<this.chunkStatus.length;h++)this.chunkStatus[h]=!1}},i.TYPE_DIRECTORY="directory",i.TYPE_FILE="file",i.CHUNK_SIZE=65536,i.UPLOAD_NOT_STARTED=0,i.UPLOAD_PROCESSING=1,i.UPLOAD_SENDING=2,i.UPLOAD_COMPLETED=3,t.exports=i}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(1),r=(n(0),n(50)),i=function(){this.listeners=new Map};i.prototype.setQueue=function(t){this.queue=t},i.prototype.register=function(t){var e=this.listeners.get(t);if(void 0===e){var n=new r.Subject;e=new i.Entry(t,n),this.listeners.set(t,e)}return e.s},i.prototype.deregister=function(t){var e=this.listeners.get(t);void 0===e||null!=e.s.observers&&0!==e.s.observers.length||this.listeners.delete(t)},i.prototype.notify=function(t,n,r,i,o,s,u,c){var a=this,l=this.listeners.get(r);if(void 0!==l){var h={owner:t,branch:n,objId:r,obj:i,commit:o};l.s.next(h)}if(null!=this.queue){var f;if(null!=s&&e.isInitialized(s)){var p=e.getCommits(s);p.length>0&&(f=p[p.length-1].commitId)}u.getMetaInfo(n,["listeners"]).then(function(e){for(var i=0;null!=e&&null!=e.listeners&&i<e.listeners.length;i++){var s={id:r,owner:t,branch:n,message:o,users:e.listeners[i].users,groups:e.listeners[i].groups,head:f,isSearch:c};a.queue.sendMessage(e.listeners[i].queue,s,0)}return null});for(var d=e.getListeners(i),m=0;null!=d&&m<d.length;m++){var y={id:r,owner:t,branch:n,message:o,users:d[m].users,groups:d[m].groups,head:f,isSearch:c};a.queue.sendMessage(d[m].queue,y,0)}}},i.Entry=function(t,e){this.objId=t,this.s=e},t.exports=i}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(4),r=n(1),i=function(t,e){this.repo=t,this.branch=e};i.prototype.add=function(t,n,o,s,u,c,a){var l=new i.Entry(t,n,o,s,u,c,a);return r.init(l),(new e).assignUserToObject(r.getUsers(l),n,!0,!0),this.repo.commit(this.branch,l,"Pull request ("+s+") "+t+" => "+o+" owned by: "+n)},i.Entry=function(t,e,n,r,o,s,u){this.localBranch=t,this.remoteOwner=e,this.remoteBranch=n,this.remoteObjectId=r,this.reference=o,this.commits=s,this.head=u,this.status=i.STATUS_OPEN},i.STATUS_OPEN=0,i.STATUS_MERGED=1,i.STATUS_REJECTED=2,t.exports=i}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(2),r=(n(0),n(10)),i=n(3),o=n(1),s=function(t,e,n){this.repo=t,this.searchBranch=e,this.dataBranch=n};s.prototype.getSearchEntry=function(t,n,u,c,a,l,h,f){var p=new s.Entry(n,c,a,l,h);return o.setId(p,t),this.repo.get(this.searchBranch,o.getId(p)).bind(this).then(function(t){return null!==t&&e.assign(p,t),p.expiry=new Date(p.expiry),p.expiry<=new Date?(n=r.convert(JSON.parse(JSON.stringify(n))),this.repo.search(this.dataBranch,n,c,a,l,h,!0)):null}).then(function(t){if(null!=t){if(new i(p.data,t).didChange())return p.data=t,p.expiry=new Date((new Date).getTime()+u*s.MILLI_TO_SECS),null!=f&&o.setListeners(p,f),this.repo.commit(this.searchBranch,p,"Updated search results triggerred from getSearchEntry.")}return p})},s.mergeSearchResults=function(t,n){var r=e.differenceBy(n,t,o.getId),i=e.intersectionWith(n,t,function(t,e){var n=!1;if(o.getId(t)===o.getId(e)){var r=o.getCommits(t),i=o.getCommits(e),s=r[r.length-1],u=i[i.length-1];new Date(s.dateAndTime)>new Date(u.dateAndTime)&&(n=!0)}return n}),s=e.differenceBy(t,i,o.getId);return e.concat(r,i,s)},s.mergeSearchResultsForIds=function(t,n,r){function i(t){for(var e="",n=0;n<r.length;n++){e+=t[r[n]]}return e}var o=e.differenceBy(n,t,i),s=e.intersectionWith(n,t,function(t,e){var n=!1;return i(t)===i(e)&&(n=!0),n}),u=e.differenceBy(t,s,i);return e.concat(o,s,u)},s.sortResults=function(t,n){for(var r=Array.isArray(n)?n:Object.keys(n),i=new Array(r.length),o=0;o<r.length;o++){var s=r[o];i[o]=null==n[s]||n[s]>0?"asc":"desc"}return e.orderBy(t,r,i)},s.Entry=function(t,e,n,r,i){this.data=null,this.expiry=new Date,o.init(this)},s.MILLI_TO_SECS=1e3,t.exports=s}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(11),r=n(0),i=function(t){this.url=t,this.state=i.STATE_DISCONNECTED,this.socket=null,this.promiseOnConnection=null,this.resolveFunctionForConnection=null,this.promiseOnDisconnection=null,this.resolveFunctionForDisconnection=null,this.promiseOnConnection=this.promiseForConnection(),this.promiseOnDisconnection=this.promiseForDisconnection()};i.prototype.connect=function(t,n){var r=this;return this.owner=t,this.token=n,this.socket=e(this.url),this.socket.on("connect",function(){r.promiseOnDisconnection=r.promiseForDisconnection(),r.onConnect()}),this.socket.on("disconnect",function(){r.promiseOnConnection=r.promiseForConnection(),r.onDisconnect()}),this.promiseOnConnection},i.prototype.disconnect=function(){this.token=null;var t=this.socket.disconnect(!0);return this.socket.removeAllListeners(),this.socket=null,t},i.prototype.promiseForConnection=function(){var t=this;return new r(function(e){t.resolveFunctionForConnection=e})},i.prototype.promiseForDisconnection=function(){var t=this;return new r(function(e){t.resolveFunctionForDisconnection=e})},i.prototype.onConnect=function(){this.state=i.STATE_CONNECTED,null!==this.resolveFunctionForConnection&&this.resolveFunctionForConnection(this.socket)},i.prototype.onDisconnect=function(){this.state=i.STATE_DISCONNECTED,null!==this.resolveFunctionForDisconnection&&this.resolveFunctionForDisconnection(null)},i.prototype.onData=function(t){this.socket.on(i.NOTIFY_COMMITS,function(e,n){e.type=i.SYNC_NOTIFY_DATA,t(e)}),this.socket.on(i.CLIENT_NOTIFICATIONS,function(e,n){e.type=i.SYNC_SEND_NOTIFICATION,t(e)})},i.prototype.emitWithTimeout=function(t,e){var n=this;return new r(function(r,o){var s=!1;n.socket.emit(t,e,function(t){s||(s=!0,r(t))}),setTimeout(function(){s||(s=!0,r({error:i.SYNC_HTTP_TIMEOUT,error_message:"Request timed out by client after "+i.REQUEST_TIMEOUT+" millseconds."}))},i.REQUEST_TIMEOUT)}).then(function(t){return void 0!==t.error?n.handleError(t):t})},i.prototype.pull=function(t,e,n,r,o,s){var u={header:{token:this.token},params:{user:t,branch:e,id:n},query:{start:o,end:s}};return this.emitWithTimeout(i.GET_DOCUMENT,u)},i.prototype.push=function(t,e,n,r,o,s){var u={header:{token:this.token},params:{user:e,branch:n,id:r},body:{branchFrom:t,commits:o,head:s}};return null==u.body.head&&delete u.body.head,this.emitWithTimeout(i.POST_COMMITS,u).then(function(t){return o})},i.prototype.search=function(t,e,n,r,o,s,u,c,a,l,h,f){var p={header:{token:this.token},params:{id:n,user:t,branch:e},query:{start:l,end:h,refreshTime:o},body:{query:r,projections:s,sort:u,start:c,limit:a,listeners:f}};return this.emitWithTimeout(i.SEARCH_BRANCH,p)},i.prototype.createBranch=function(t,e,n,r){var o={header:{token:this.token},params:{user:this.owner,branch:t},body:{users:e,groups:n,listeners:r}};return this.emitWithTimeout(i.CREATE_BRANCH,o).then(function(t){return!0})},i.prototype.notify=function(t,e,n,r){var o={header:{token:this.token},params:{user:this.owner},body:{ref:t,users:n,groups:r,doc:e}};return this.emitWithTimeout(i.CLIENT_NOTIFICATIONS,o),!0},i.prototype.chunkForFile=function(t,e,n,r,o){var s={header:{token:this.token},params:{id:t,user:o,branch:r},body:{chunkNumber:e,chunk:n}};return this.emitWithTimeout(i.POST_FILE_CHUNK,s).then(function(t){return!0})},i.prototype.mergeChunksForFile=function(t,e,n){var r={header:{token:this.token},params:{id:t,user:n,branch:e}};return this.emitWithTimeout(i.MERGE_FILE_CHUNK,r)},i.prototype.handleError=function(t){var e=new Error(t.error_message);throw e.status=t.error,e.body=t.error_message,e},i.STATE_DISCONNECTED=0,i.STATE_CONNECTED=1,i.REQUEST_TIMEOUT=12e4,i.SYNC_HTTP_TIMEOUT=504,i.SEARCH_BRANCH="search branch",i.GET_DOCUMENT="get document",i.POST_COMMITS="post commits",i.NOTIFY_COMMITS="notify commits",i.CLIENT_NOTIFICATIONS="client notifications",i.CREATE_BRANCH="create branch",i.POST_FILE_CHUNK="post file chunk",i.MERGE_FILE_CHUNK="merge file chunk",i.SYNC_NOTIFY_DATA=6,i.SYNC_SEND_NOTIFICATION=7,t.exports=i}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(0),r=n(1),i=function(t,e,n,r,i){this.client=t,this.repo=e,this.branch=n,this.name=r,this.callback=i,this.pendingSync=0,this.totalSync=0,this.syncPromise=null,this.highPriority=[],this.normalPriority=[],this.lowPriority=[],this._setup=this.setupNotifications()};i.prototype.setupNotifications=function(){var t=this;return this.client.promiseOnConnection.then(function(){return t.client.onData(function(e){return e.type===i.NOTIFY_DATA?t.callback(null,e.message,{type:e.type,args:[e.owner,e.branch,e.id,e.head,e.isSearch]}):e.type===i.SEND_NOTIFICATION?t.callback(null,e.message,{type:e.type,args:[e.owner]}):void 0}),t.client.promiseOnDisconnection}).then(function(){return t.setupNotifications(),null})},i.prototype.add=function(t,e,n,r){var o=new i.Entry(t,e,n);o=JSON.parse(JSON.stringify(o));for(var s=!1,u=0;!s&&u<r.length;u++)r[u].ref===n&&(s=!0,r[u]=o);s||(r.push(o),this.totalSync++,(null===this.syncPromise||this.syncPromise.isFulfilled())&&(this.totalSync=1,this.syncPromise=this.run(this.normalPriority,this.highPriority,this.lowPriority,this.callback)))},i.prototype.run=function(t,n,r,o){if(this.pendingSync=n.length+t.length+r.length,0===this.pendingSync)return e.resolve(!0);var s=null,u=null,c=this;return this.client.promiseOnConnection.then(function(){switch(u=n.length>0?n:t.length>0?t:r,s=u[0],s.type){case i.PULL_ENTRY:return c.client.pull.apply(c.client,s.args);case i.PUSH_ENTRY:return c.client.push.apply(c.client,s.args);case i.SEARCH_ENTRY:return c.client.search.apply(c.client,s.args);case i.CREATE_BRANCH:return c.client.createBranch.apply(c.client,s.args);case i.SEND_NOTIFICATION:return c.client.notify.apply(c.client,s.args);case i.POST_FILE_CHUNK:return c.client.chunkForFile.apply(c.client,s.args);case i.MERGE_FILE_CHUNK:return c.client.mergeChunksForFile.apply(c.client,s.args)}}).then(function(t){return o(null,t,s)}).catch(function(t){return o(t,null,s)}).then(function(e){return e&&u.shift(),c.run(t,n,r,o)})},i.prototype.pull=function(t,e,n,r,o,s){var u="pull"+t+e+n+r+o+s;this.add(i.PULL_ENTRY,[].slice.call(arguments),u,this.normalPriority)},i.prototype.push=function(t,e,n,r,o,s,u){var c="push"+e+n+r+s;this.add(i.PUSH_ENTRY,[].slice.call(arguments),c,!0===u?this.highPriority:this.normalPriority)},i.prototype.search=function(t,e,n,r,o,s,u,c,a,l,h,f){var p="search"+t+e+n;this.add(i.SEARCH_ENTRY,[].slice.call(arguments),p,this.normalPriority)},i.prototype.createBranch=function(t,e,n,r){var o="createBranch"+t;this.add(i.CREATE_BRANCH,[].slice.call(arguments),o,this.normalPriority)},i.prototype.notify=function(t,e,n,o){var s="notify"+t+r.getId(e);this.add(i.SEND_NOTIFICATION,[].slice.call(arguments),s,this.normalPriority)},i.prototype.chunkForFile=function(t,e,n,r,o){var s="chunkForFile"+t+e+r+o;this.add(i.POST_FILE_CHUNK,[].slice.call(arguments),s,this.lowPriority)},i.prototype.mergeChunksForFile=function(t,e,n){var r="mergeChunksForFile"+t+e+n;this.add(i.MERGE_FILE_CHUNK,[].slice.call(arguments),r,this.lowPriority)},i.Entry=function(t,e,n){this.type=t,this.args=e,this.ref=n},i.PULL_ENTRY=0,i.PUSH_ENTRY=1,i.SEARCH_ENTRY=2,i.CREATE_BRANCH=3,i.POST_FILE_CHUNK=4,i.MERGE_FILE_CHUNK=5,i.NOTIFY_DATA=6,i.SEND_NOTIFICATION=7,t.exports=i}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(0),r=e.promisifyAll(n(30)),i=n(2),o=n(1),s=function(t,e){this.repo=t,this.branch=e};s.prototype.getUserByEmailOrId=function(t,n,r){var i=null;return i=null==n?this.branch.findOne({emailOrId:t},r):this.branch.findOne({$and:[{emailOrId:t},{status:n}]},r),this.repo.db.promisified||(i=e.resolve(i)),i},s.prototype.getUserByToken=function(t,n,r){var i={};if(void 0===n)if("LokiJs"===this.branch.type)i.tokens={$contains:t};else{var o="tokens."+t;i[o]={$exists:!0}}else if("LokiJs"===this.branch.type)i={$and:[{},{status:n}]},i.$and[0].tokens={$contains:t};else{var o="tokens."+t;i={$and:[{},{status:n}]},i.$and[0][o]={$exists:!0}}var s=this.branch.findOne(i,r);return this.repo.db.promisified||(s=e.resolve(s)),s},s.prototype.getUserByRefreshToken=function(t,n,r){var i={};if(void 0===n)if("LokiJs"===this.branch.type)i.refreshTokens={$contains:t};else{var o="refreshTokens."+t;i[o]={$exists:!0}}else if("LokiJs"===this.branch.type)i={$and:[{},{status:n}]},i.$and[0].refreshTokens={$contains:t};else{var o="refreshTokens."+t;i={$and:[{},{status:n}]},i.$and[0][o]={$exists:!0}}var s=this.branch.findOne(i,r);return this.repo.db.promisified||(s=e.resolve(s)),s},s.prototype.addUser=function(t,e,n,r,i){return this.getUserByEmailOrId(e,["emailOrId"]).bind(this).then(function(t){if(null!==t)throw new Error("User already exists with id "+e);return this.generatePasswordOrSecret(n)}).then(function(n){var u=new s.User(t,e,n,s.User.STATUS_ACTIVE,r);return o.init(u),o.setId(u,e),this.repo.commit(this.branch,u,i)})},s.prototype.changeUserStatus=function(t,e,n){return this.getUserByEmailOrId(t).bind(this).then(function(r){if(null===r)throw new Error("No such user with id "+t);return r.status=e,r.retries=0,this.repo.commit(this.branch,r,n)})},s.prototype.updateUserToken=function(t,e,n,r){return this.getUserByEmailOrId(t).bind(this).then(function(i){if(null===i)throw new Error("No such user with id "+t);return i.tokens[""+e]=n,this.repo.commit(this.branch,i,r)})},s.prototype.updateRefreshToken=function(t,e,n,r,i){return this.getUserByEmailOrId(t).bind(this).then(function(o){if(null===o)throw new Error("No such user with id "+t);return o.refreshTokens[""+n]={clientId:e,expiry:r},this.repo.commit(this.branch,o,i)})},s.prototype.removeExpiredTokens=function(t,e){return this.getUserByEmailOrId(t).bind(this).then(function(n){if(null===n)throw new Error("No such user with id "+t);for(var r="",o=!1;void 0!==(r=i.findKey(n.tokens,function(t){return new Date(t)<new Date}));)o=!0,delete n.tokens[r];for(;void 0!==(r=i.findKey(n.refreshTokens,function(t){return new Date(t.expiry)<new Date}));)o=!0,delete n.refreshTokens[r];return o?this.repo.commit(this.branch,n,e):n})},s.prototype.verifyUserPasswordOrSecret=function(t,n,i,o){var u=this.getUserByEmailOrId(t,s.User.STATUS_ACTIVE),c=u.bind(this).then(function(e){if(null===e||i!==e.grantType)throw new Error("No user with id "+t+" is allowed to login with grantType "+i);return r.compareAsync(n,e.passwordOrSecret)});return e.all([u,c]).bind(this).spread(function(t,e){return t.lastLoginTime=new Date,e?(t.retries=0,this.repo.commit(this.branch,t,"Successful login: "+o)):(t.retries++,this.repo.commit(this.branch,t,"Failed login: "+o))}).then(function(t){if(0===t.retries)return t;throw new Error("Incorrect username or password")})},s.prototype.changeUserPasswordOrSecret=function(t,n,r){var i=this.getUserByEmailOrId(t),o=i.bind(this).then(function(e){if(null===e)throw new Error("No such user with id "+t);return this.generatePasswordOrSecret(n)});return e.all([i,o]).bind(this).spread(function(t,e){return t.passwordOrSecret=e,t.retries=0,this.repo.commit(this.branch,t,r)})},s.prototype.generatePasswordOrSecret=function(t){return r.genSaltAsync(10,10).then(function(e){return r.hashAsync(t,e)})},s.User=function(t,e,n,r,i){this.name=t,this.emailOrId=e,this.passwordOrSecret=n,this.status=r,this.grantType=i,this.retries=0,this.lastLoginTime=null,this.tokens={},this.refreshTokens={},this.groups=[]},s.User.STATUS_ACTIVE="active",s.User.STATUS_INACTIVE="inactive",s.User.GRANT_PASSWORD="password",s.User.GRANT_CLIENT_CREDENTIALS="client_credentials",t.exports=s}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(32).sha3_256,r={};r.hash=function(t){return e(t)},t.exports=r}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(2),r=n(0),i=n(7),o=n(8),s=n(3),u=n(1),c=n(5),a=n(9),l=function(t,e,n,r,o){this.debug=null!=o&&o,this.user=t,this.db=e,this.notifications=n,this.MapReduce=r,this.branches=new i(this.user,this.db)};l.prototype.setup=function(){return this.branches.setup()},l.prototype.get=function(t,e){var n={};n[u.ID_PATH]=e;var i=t.findOne(n);return this.db.promisified||(i=r.resolve(i)),i.then(function(t){return null===t&&(t=u.init({}),u.setId(t,e)),t})},l.prototype.search=function(t,e,n,i,o,s,u){var c=null,a=null;null!=n&&null!=n.reduce&&(c=new this.MapReduce(n,this.debug)),null!=n&&null!=n.map&&(a=n.map.values);var l=t.search(e,a,c,i,o,s);return this.db.promisified||!0===u||(l=r.resolve(l)),l},l.prototype.commit=function(t,e,n,i){var a=null,h=!1,f=null,p=this,d=null,m=JSON.parse(JSON.stringify(e));if(delete m._id,u.isInitialized(m)){var y={};y[u.ID_PATH]=u.getId(m),a=t.findOne(y),p.db.promisified||(a=r.resolve(a))}else u.init(m),a=r.resolve(null);return a=a.then(function(e){var r=!1;null===e&&(e={}),u.isInitialized(e)||(r=!0,u.init(e),u.setId(e,u.getId(m))),d=JSON.parse(JSON.stringify(e));var a=null,y=u.removeMeta(d),g=JSON.parse(JSON.stringify(y));u.removeMeta(m);var v=new s(d,m);if(v.didChange()||null!=i){m=c.merge(e,[v]),u.setMeta(m,y),f=new o(u.getCommits(m)),f.addCommit(JSON.parse(JSON.stringify(v)),n,new Date,p.user,i);var S=f.getNoOfCommits();f.getNoOfCommits()>l.MAX_COMMITS&&p.truncateCommits(f,l.TRUNCATE_COMMITS,p.user);var T={};T[u.ID_PATH]=u.getId(m),a=t.findAndMerge(T,m,[v],u.getCommits(m),r,S),h=!0}else a=e;return u.setMeta(d,g),a}),a.then(function(e){if(!0===h&&void 0!==p.notifications&&null!==p.notifications){var n=f.getAllCommits();p.notifications.notify(p.user,t.getName(),u.getId(e),e,n[n.length-1],d,p.branches,t.isSearchBranch())}return e}),a},l.prototype.mergeToBranch=function(t,e,n,i,o,s){var c=this;return this.get(t,e).then(function(l){var h=l,f=null,p=null;if(0===n.length)return h;f=new a(u.getPulls(h)),void 0!==s&&(p=f.getPullInformation(s),null==o&&null!==p&&(o=p.head));var d=c.getMergeReport(h,n,o);if(0!==d.conflicts.length)throw new Error("Merge Conflict");null===p||void 0===p.doc||n[0].isFirst?null==o||null==l||n[0].isFirst?(h=u.init({}),u.setId(h,e),u.setPulls(h,f.pulls)):h=l:h=p.doc;var m,y,g;return d.discardedCommits.length>0&&(g=c.mergeCommitsToDocument(h,d.discardedCommits,""),h=g.doc),d.theirCommits.length>0?(g=c.mergeCommitsToDocument(h,d.theirCommits,i),m=g.commitId,y=c.commit(t,g.doc,g.message,g.commitId)):(m=n[n.length-1].commitId,y=r.resolve(h)),void 0!==s&&(y=y.then(function(e){return c.updatePullHead(t,e,s,m)})),d.ourCommits.length>0&&d.theirCommits.length>0&&(y=y.then(function(e){var n=c.mergeCommitsToDocument(e,d.ourCommits,i);return c.commit(t,n.doc,n.message,n.commitId)})),y})},l.prototype.confirmMergeToBranch=function(t,e,n,r){var i=this;return this.get(t,e).then(function(e){return null!==e&&i.updatePullHead(t,e,r,n[n.length-1].commitId),e})},l.prototype.updatePullHead=function(t,e,n,r){var i=new a(u.getPulls(e)),o=JSON.parse(JSON.stringify(e));u.resetMeta(o);var c=JSON.parse(JSON.stringify(e));i.updatePull(n,r,o);var l={};l[u.ID_PATH]=u.getId(e);var h=new s(c,e);return t.update(l,e,[h])},l.prototype.getMergeReport=function(t,n,r){var i=new o(u.getCommits(t)),s=i.getFilteredCommits(r),c=i.getFilteredCommits(null,r),a=[];e.remove(s,function(t){return e.findIndex(n,function(e){return e.commitId===t.commitId})>=0});for(var h=!1,f=c.length-1;f>=0&&!h;f--)for(var p=c[f],d=n.length-1;d>=0&&!h;d--){var m=n[d];m.commitId===p.commitId&&(h=!0,a=n.slice(0,d+1),n=n.slice(d+1))}return new l.MergeReport(s,n,a,[])},l.prototype.truncateCommits=function(t,e,n){var r=t.getNoOfCommits()-e,i=t.remove(r),o=u.init({});u.removeMeta(o),o=this.mergeCommitsToDocument(o,i,"").doc;var c=u.init({});u.removeMeta(c);var a=new s(c,o);return t.prefixCommit(a,l.MAX_COMMITS_LOG_MESSAGE,new Date,n,i[i.length-1].commitId),t},l.prototype.mergeCommitsToDocument=function(t,e,n){for(var r="",i=0;i<e.length;i++){var o=e[i];r=o.commitId,t=c.merge(t,[o.diff]),n=n+" "+o.logMessage+" ("+r+")."}return new l.MergedCommit(t,n,r)},l.MergeReport=function(t,e,n,r){this.ourCommits=t,this.theirCommits=e,this.discardedCommits=n,this.conflicts=r},l.MergedCommit=function(t,e,n){this.doc=t,this.message=e,this.commitId=n},l.MAX_COMMITS=100,l.TRUNCATE_COMMITS=80,l.MAX_COMMITS_LOG_MESSAGE="Merged previous commits",t.exports=l}).call(void 0)},function(t,e,n){"use strict";(function(){var e={JitACL:n(4),JitBranches:n(7),JitCommits:n(8),JitDiff:n(3),JitDocument:n(1),JitFileHash:n(25),JitLocalQueue:n(15),JitLokiDb:n(13),JitMathLib:n(6),JitMerge:n(5),JitPulls:n(9),JitRepository:n(26),JitClient:n(17),JitFileManager:n(18),JitMapReduceMath:n(16),JitNotifications:n(19),JitPullRequests:n(20),JitSearch:n(21),JitSocketClient:n(22),JitSQS:n(14),JitSync:n(23),JitUserManagement:n(24)};t.exports=e}).call(void 0)},function(t,e,n){"use strict";(function(){var e=n(2),r=(n(0),n(1)),i=n(5),o=function(t,e,n){this._name=t,this.collection=e,this._isSearch=n,this.type="LokiJs"};o.prototype.search=function(t,e,n,r,i,o){var s=[];if(s.push({type:"find",value:t}),null!=r){for(var u=Object.keys(r),c=new Array(u.length),a=0;a<u.length;a++)c[a]=[u[a],1!==r[u[a]]];s.push({type:"compoundsort",value:c})}null!=n&&s.push({type:"mapReduce",mapFunction:function(t,e,r){return t=JSON.parse(JSON.stringify(t)),n.map(t,e,r)},reduceFunction:function(t){return n.reduce(t)}});var l=this.collection.chain(s);null==n&&(l=JSON.parse(JSON.stringify(l.data())));for(var a=0;a<l.length;a++)delete l[a].meta,delete l[a].$loki;return l},o.prototype.findOne=function(t){var e=this.collection.findOne(t);return null!=e&&(e=JSON.parse(JSON.stringify(e)),delete e.meta,delete e.$loki),e},o.prototype.insert=function(t){var e=this.collection.insert(t);return e=JSON.parse(JSON.stringify(e)),delete e.meta,delete e.$loki,e},o.prototype.update=function(t,n,o,s){var u=[],c=null;return u.push({type:"find",value:t}),u.push({type:"update",value:function(t){if(r.isInitialized(t)&&null!=o){if(t=i.merge(t,o),null!=s){var u=r.getCommits(t);u.push(s[s.length-1])}}else{t=e.assign(t,n);for(var a=e.keys(t),l=e.keys(n),a=e.keys(t),l=e.keys(n),h=e.difference(a,l),f=0;f<h.length;f++){var p=h[f];"$loki"!==p&&"meta"!==p&&"_jsonit"!==p&&delete t[p]}}c=JSON.parse(JSON.stringify(t)),delete c.meta,delete c.$loki}}),this.collection.chain(u),null!=c?c:n},o.prototype.findAndMerge=function(t,e,n,r,i){return i?this.insert(e):this.update(t,e,n,r)},o.prototype.remove=function(t){var e=this.collection.findOne(t);this.collection.remove(e)},o.prototype.getName=function(){return this._name},o.prototype.isSearchBranch=function(){return this._isSearch},t.exports=o}).call(void 0)},function(t,e){t.exports=require("aws-sdk")},function(t,e){t.exports=require("bcryptjs")},function(t,e){t.exports=require("client-oauth2")},function(t,e){t.exports=require("js-sha3")},function(t,e){t.exports=require("lokijs")},function(t,e){t.exports=require("mathjs/core")},function(t,e){t.exports=require("mathjs/lib/expression/function")},function(t,e){t.exports=require("mathjs/lib/function/arithmetic")},function(t,e){t.exports=require("mathjs/lib/function/bitwise")},function(t,e){t.exports=require("mathjs/lib/function/logical")},function(t,e){t.exports=require("mathjs/lib/function/matrix")},function(t,e){t.exports=require("mathjs/lib/function/probability/pickRandom")},function(t,e){t.exports=require("mathjs/lib/function/probability/random")},function(t,e){t.exports=require("mathjs/lib/function/relational")},function(t,e){t.exports=require("mathjs/lib/function/unit")},function(t,e){t.exports=require("mathjs/lib/function/utils")},function(t,e){t.exports=require("mathjs/lib/type/boolean")},function(t,e){t.exports=require("mathjs/lib/type/matrix")},function(t,e){t.exports=require("mathjs/lib/type/resultset")},function(t,e){t.exports=require("mathjs/lib/type/unit")},function(t,e){t.exports=require("moment")},function(t,e){t.exports=require("rxjs/Subject")}]);